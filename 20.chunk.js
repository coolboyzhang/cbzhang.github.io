webpackJsonp([20],{"./app/components/NoticeSetting/index.js":function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=n("./node_modules/react/index.js"),u=n.n(a),s=n("./node_modules/prop-types/index.js"),c=(n.n(s),n("./app/utils/Storage.js")),l=n("./app/utils/timer.js"),g=n("./node_modules/antd/lib/index.js"),f=(n.n(g),function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,o){var r=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&r)for(var u in r)void 0===n[u]&&(n[u]=r[u]);else n||(n=r||{});if(1===a)n.children=o;else if(a>1){for(var s=Array(a),c=0;c<a;c++)s[c]=arguments[c+3];n.children=s}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}()),h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),p=f(g.Select.Option,{value:"YYYYMMDD"},void 0,"提前"),v=f(g.Select.Option,{value:"Date"},void 0,"每隔"),y=f(g.Select.Option,{value:"MMDD"},void 0,"每年提前"),b=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={thingSettings:[],selectThingId:"",selectThing:{},btnLoading:!1},n}return r(t,e),d(t,[{key:"componentWillMount",value:function(){this.getThingSettingList()}},{key:"componentWillReceiveProps",value:function(e){e.visible&&this.getThingSettingList()}},{key:"getThingSettingList",value:function(e){var t=this,n=this.props.user;c.a.queryBmob("NoticeSetting",function(e){return e.equalTo("userId",n.objectId),e.equalTo("type","thing"),e},function(n){e?t.setState({thingSettings:n,selectThingId:e,btnLoading:!1}):t.setState({thingSettings:n,selectThingId:"",selectThing:{},btnLoading:!1})},null,"find")}},{key:"createThingTag",value:function(){var e=this,t=this.props.user;c.a.createBmob("NoticeSetting",{rules:[],tag:Object(l.a)().str("YYMDHms"),type:"thing",userId:t.objectId,isSys:!1},function(t){return e.getThingSettingList(t.id)})}},{key:"selectThing",value:function(e){var t=this.state.thingSettings,n=t.find(function(t){return t.objectId===e});this.setState({selectThingId:e,selectThing:JSON.parse(JSON.stringify(n))})}},{key:"changeRule",value:function(e,t){var n=this.state.selectThing;void 0===e?n.rules.push({type:"YYYYMMDD",count:0}):t?n.rules[e]=h({},n.rules[e],t):n.rules=n.rules.filter(function(t,n){return n!==e}),this.setState({selectThing:n})}},{key:"saveRule",value:function(){var e=this,t=this.props.user,n=this.state.selectThing;this.setState({btnLoading:!0}),c.a.queryBmob("NoticeSetting",function(e){return e.equalTo("userId",t.objectId),e.equalTo("tag",n.tag),e.notEqualTo("objectId",n.objectId),e},function(t){if(t>0)return g.message.error("不能与其他tag重名"),void e.setState({btnLoading:!1});c.a.setBmob("NoticeSetting",n.objectId,n,function(){return e.getThingSettingList()})},null,"count")}},{key:"changeTagName",value:function(e){var t=this.state.selectThing;t.tag=e,this.setState({selectThing:t})}},{key:"render",value:function(){var e=this,t=this.state,n=t.thingSettings,i=t.selectThingId,o=t.selectThing,r=t.btnLoading;return f("div",{style:{height:"300px",width:"500px"}},void 0,i?f("div",{},void 0,f("div",{className:"mb_10"},void 0,f(g.Icon,{type:"arrow-left",onClick:function(){return e.getThingSettingList()}}),f(g.Button,{loading:r,className:"ml_10",type:"primary",onClick:function(){return e.saveRule()}},void 0,"保存")),f(g.Input,{disabled:o.isSys,value:o.tag,onChange:function(t){return e.changeTagName(t.target.value)},className:"w_200"}),f("div",{},void 0,o.rules&&o.rules.map(function(t,n){return f("div",{className:"mt_10"},"n-rule-"+n,f(g.Select,{value:t.type,className:"w_100",onChange:function(t){return e.changeRule(n,{type:t})}},void 0,p,v,y),f(g.InputNumber,{min:0,precision:0,value:t.count,onChange:function(t){return e.changeRule(n,{count:t})}}),"天提醒",f(g.Icon,{type:"delete",className:"ml_10 fc_red pointer",onClick:function(){return e.changeRule(n)}}))}),f(g.Button,{className:"mt_15",onClick:function(){return e.changeRule()}},void 0,"新的提醒"))):f("div",{},void 0,f(g.Button,{className:"mb_10",onClick:function(){return e.createThingTag()}},void 0,"加一个规则"),f("div",{},void 0,n.map(function(t){return f(g.Tag,{onClick:function(){return e.selectThing(t.objectId)},style:{minHeight:"30px",lineHeight:"30px"}},t.objectId,t.tag)}))))}}]),t}(u.a.Component);t.default=b}});