webpackJsonp([24],{"./app/components/NoticeSetting/index.js":function(e,t,n){"use strict";function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function i(r,o){try{var a=t[r](o),s=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(s).then(function(e){i("next",e)},function(e){i("throw",e)});e(s)}return i("next")})}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=n("./node_modules/_react@16.8.6@react/index.js"),u=n.n(s),c=n("./node_modules/_prop-types@15.5.10@prop-types/index.js"),l=(n.n(c),n("./app/utils/hydrogen.js")),g=n("./app/utils/timer.js"),h=n("./node_modules/_antd@3.5.2@antd/lib/index.js"),f=(n.n(h),function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,r){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=r;else if(a>1){for(var u=Array(a),c=0;c<a;c++)u[c]=arguments[c+3];n.children=u}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}()),p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),v=f(h.Select.Option,{value:"YYYYMMDD"},void 0,"提前"),y=f(h.Select.Option,{value:"Date"},void 0,"每隔"),b=f(h.Select.Option,{value:"MMDD"},void 0,"每年提前"),m=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={thingSettings:[],selectThingId:"",selectThing:{},btnLoading:!1},n}return a(t,e),d(t,[{key:"componentWillMount",value:function(){this.getThingSettingList()}},{key:"componentWillReceiveProps",value:function(e){e.visible&&this.getThingSettingList()}},{key:"getThingSettingList",value:function(e){var t=this,n=this.props.user;l.a.query({table:"NoticeSetting",e:{userId:n.objectId,type:"thing"}}).then(function(n){e?t.setState({thingSettings:n,selectThingId:e,btnLoading:!1}):t.setState({thingSettings:n,selectThingId:"",selectThing:{},btnLoading:!1})})}},{key:"createThingTag",value:function(){var e=this,t=this.props.user;l.a.create({table:"NoticeSetting",obj:{rules:[],tag:Object(g.a)().str("YYMDHms"),type:"thing",userId:t.objectId,isSys:!1}}).then(function(t){return e.getThingSettingList(t.objectId)})}},{key:"selectThing",value:function(e){var t=this.state.thingSettings,n=t.find(function(t){return t.objectId===e});this.setState({selectThingId:e,selectThing:JSON.parse(JSON.stringify(n))})}},{key:"changeRule",value:function(e,t){var n=this.state.selectThing;void 0===e?n.rules.push({type:"YYYYMMDD",count:0}):t?n.rules[e]=p({},n.rules[e],t):n.rules=n.rules.filter(function(t,n){return n!==e}),this.setState({selectThing:n})}},{key:"saveRule",value:function(){function e(){return t.apply(this,arguments)}var t=i(regeneratorRuntime.mark(function e(){var t,n,i,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.user,n=this.state.selectThing,this.setState({btnLoading:!0}),e.next=5,l.a.query({table:"NoticeSetting",e:{userId:t.objectId,tag:n.tag},n:{objectId:n.objectId},single:!0});case 5:if(!(i=e.sent)){e.next=9;break}return this.setState({btnLoading:!1}),e.abrupt("return",h.message.error("不能与其他tag重名"));case 9:l.a.set({table:"NoticeSetting",id:n.objectId,obj:n}).then(function(){return r.getThingSettingList()});case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"changeTagName",value:function(e){var t=this.state.selectThing;t.tag=e,this.setState({selectThing:t})}},{key:"render",value:function(){var e=this,t=this.state,n=t.thingSettings,i=t.selectThingId,r=t.selectThing,o=t.btnLoading;return f("div",{style:{height:"300px",width:"500px"}},void 0,i?f("div",{},void 0,f("div",{className:"mb_10"},void 0,f(h.Icon,{type:"arrow-left",onClick:function(){return e.getThingSettingList()}}),f(h.Button,{loading:o,className:"ml_10",type:"primary",onClick:function(){return e.saveRule()}},void 0,"保存")),f(h.Input,{disabled:r.isSys,value:r.tag,onChange:function(t){return e.changeTagName(t.target.value)},className:"w_200"}),f("div",{},void 0,r.rules&&r.rules.map(function(t,n){return f("div",{className:"mt_10"},"n-rule-"+n,f(h.Select,{value:t.type,className:"w_100",onChange:function(t){return e.changeRule(n,{type:t})}},void 0,v,y,b),f(h.InputNumber,{min:0,precision:0,value:t.count,onChange:function(t){return e.changeRule(n,{count:t})}}),"天提醒",f(h.Icon,{type:"delete",className:"ml_10 fc_red pointer",onClick:function(){return e.changeRule(n)}}))}),f(h.Button,{className:"mt_15",onClick:function(){return e.changeRule()}},void 0,"新的提醒"))):f("div",{},void 0,f(h.Button,{className:"mb_10",onClick:function(){return e.createThingTag()}},void 0,"加一个规则"),f("div",{},void 0,n.map(function(t){return f(h.Tag,{onClick:function(){return e.selectThing(t.objectId)},style:{minHeight:"30px",lineHeight:"30px"}},t.objectId,t.tag)}))))}}]),t}(u.a.Component);t.default=m}});